{% extends "header.html" %}

{% block title %}Criar Ordem de Serviço{% endblock %}

{% block content %}
<h1 class="mb-4">Criar Ordem de Serviço</h1>
<form method="post">
    <div class="form-group">
        <label for="unidade_id">Unidade:</label>
        <select class="form-control" name="unidade_id" id="unidade_id" required>
            <option value="">Selecione uma unidade</option>
            {% for unidade in unidades %}
            <option value="{{ unidade.id }}">{{ unidade.nome }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="data_previsao">Data de Previsão:</label>
        <input type="date" class="form-control" name="data_previsao" id="data_previsao" required>
    </div>
    <div class="form-group">
        <label for="tecnicos">Técnicos:</label>
        <select class="form-control" name="tecnicos" id="tecnicos" multiple required>
            {% for tecnico in tecnicos %}
            <option value="{{ tecnico.id }}">{{ tecnico.nome }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="demanda_ids">Demandas:</label>
        <select class="form-control" name="demanda_ids" id="demanda_ids" multiple required>

        </select>
    </div>
    <div class="form-group">
        <label for="observacoes">Observações:</label>
        <textarea class="form-control" name="observacoes" id="observacoes" rows="4"></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Confirmar Criação da Ordem de Serviço</button>
</form>

{% if success %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    Swal.fire({
        title: 'Cadastro concluido!',
        text: 'Técnico cadastrado com sucesso!',
        icon: 'success',
        confirmButtonText: 'OK'
    });
</script>
{% endif %}
<script>
document.getElementById('unidade_id').addEventListener('change', function() {
    var unidadeId = this.value;
    var demandaSelect = document.getElementById('demanda_ids');

    demandaSelect.innerHTML = '';

    if (unidadeId) {
        fetch('/get_demandas/' + unidadeId)
            .then(response => response.json())
            .then(data => {
                data.forEach(demanda => {
                    var option = document.createElement('option');
                    option.value = demanda.id;
                    option.text = demanda.descricao;
                    demandaSelect.appendChild(option);
                });
            });
    }
});
</script>
{% endblock %}
